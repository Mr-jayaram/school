<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invoice - School Management</title>
    <link rel="shortcut icon" href="https://jaiinfo.tech/logo/logo_only.png">
    <!-- Bootstrap CSS -->
    <link href="assets/css/bootstrap.min.css" rel="stylesheet">
    <!-- Google Fonts (Example: Poppins for a similar look) -->
    <link href="assets/css/css2.css" rel="stylesheet">
    <!-- Bootstrap Icons CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
    <!-- Link to your external style.css file (if needed for global styles) -->
    <!-- <link rel="stylesheet" href="assets/css/style.css"> -->
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f8f9fa;
        }
        .invoice-container {
            margin: 30px auto;
            padding: 30px;
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            max-width: 900px;
            min-height: 80vh;
        }
        .invoice-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            border-bottom: 1px solid #e9ecef;
            padding-bottom: 20px;
        }
        .invoice-header .logo {
            max-width: 150px;
            height: auto;
        }
        .invoice-header .school-info h2 {
            margin: 0;
            color: #0056b3;
            font-weight: 700;
        }
        .invoice-header .school-info p {
            margin-bottom: 5px;
            color: #6c757d;
            font-size: 0.9em;
        }
        .invoice-info h1 {
            color: #0056b3; /* Kept blue for primary heading */
        }
        .invoice-info p {
            margin-bottom: 5px;
            font-size: 0.95em;
        }
        .invoice-info p strong {
             color: #6c757d; /* Softer color for labels */
        }
        .invoice-details {
            margin-bottom: 30px;
        }
        .invoice-details .detail-block {
            padding: 15px;
            background-color: #f1f6fa;
            border-radius: 5px;
            margin-bottom: 15px;
        }
        .invoice-details h5 {
            color: #0056b3;
            font-weight: 600;
            margin-bottom: 10px;
        }
        .invoice-details p {
            margin-bottom: 5px;
            font-size: 0.95em;
        }
        .invoice-table thead th {
            background-color: #0056b3;
            color: #ffffff;
            border-color: #0056b3;
            font-weight: 600;
        }
        .invoice-table tbody tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        .invoice-summary {
            margin-top: 30px;
            border-top: 1px solid #e9ecef;
            padding-top: 20px;
        }
        .invoice-summary .total-row {
            font-size: 1.1em;
            font-weight: 600;
            color: #0056b3;
        }
        /* Applying the new color code */
        .invoice-summary .total-row .grand-total-value,
        .invoice-summary .total-row .amount-due-value {
            color: #FFB86B; /* Your requested color */
            font-size: 1.2em;
        }

        .invoice-footer {
            margin-top: 40px;
            border-top: 1px solid #e9ecef;
            padding-top: 20px;
            text-align: center;
            color: #6c757d;
            font-size: 0.9em;
        }
        .invoice-actions {
            margin-top: 30px;
            text-align: center;
        }
        /* Style for the print button with the new color */
        .btn-print-custom {
            background-color: #FFB86B; /* Your requested color */
            border-color: #FFB86B;
            color: #fff; /* Darker text for contrast on lighter background */
            font-weight: 600;
        }
        .btn-print-custom:hover {
            background-color: #e6a05e; /* Slightly darker on hover */
            border-color: #e6a05e;
            color: #fff;
        }
        .btn-print-custom:focus {
            box-shadow: 0 0 0 0.25rem rgba(255, 184, 107, 0.5); /* Focus shadow */
        }
        /* Style for the Download PDF button - UPDATED to #e6a05e */
        .btn-download-pdf {
            background-color: #e6a05e; /* Updated primary color */
            border-color: #e6a05e;
            color: #fff; /* Darker text for contrast */
            font-weight: 600;
        }
        .btn-download-pdf:hover {
            background-color: #d08e4e; /* Slightly darker on hover */
            border-color: #d08e4e;
            color: #fff;
        }
        .btn-download-pdf:focus { /* Added focus style */
            box-shadow: 0 0 0 0.25rem rgba(230, 160, 94, 0.5);
        }


        @media print {
            body {
                background-color: #fff;
            }
            .invoice-container {
                box-shadow: none;
                margin: 0;
                padding: 0;
                max-width: 100%;
            }
            .invoice-actions {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="invoice-container" id="invoiceContainer">
        <div class="invoice-header">
            <div class="school-info text-start">
                <!-- IMPORTANT: Ensure this image path is local and correct.
                     e.g., download the logo from https://jaiinfo.tech/logo/logo_only.png
                     and place it in your 'assets/img/' folder. -->
                <img src="assets/img/logo_only.png" alt="School Logo" class="logo mb-2">
                <h2>Sunshine High School</h2>
                <p>123 School Lane, Education City, 12345</p>
                <p>Email: info@sunshinehigh.edu</p>
                <p>Phone: (123) 456-7890</p>
            </div>
            <div class="invoice-info text-end">
                <h1 class="text-primary">INVOICE</h1>
                <p class="mb-1"><strong>Invoice #</strong> INV-2024-001</p>
                <p class="mb-1"><strong>Date:</strong> 2024-10-26</p>
                <p class="mb-1"><strong>Due Date:</strong> 2024-11-26</p>
                <p class="mb-1"><strong>Academic Year:</strong> 2024-2025</p>
            </div>
        </div>

        <div class="row invoice-details">
            <div class="col-md-6">
                <div class="detail-block">
                    <h5>Bill To:</h5>
                    <p><strong>John Doe</strong></p>
                    <p>Student ID: STD-001</p>
                    <p>Class: Grade 10A</p>
                    <p>Parent/Guardian: Mr. & Mrs. Doe</p>
                    <p>101 Oak Street, Townsville, 54321</p>
                    <p>johndoe@email.com</p>
                </div>
            </div>
            <div class="col-md-6">
                <div class="detail-block">
                    <h5>Payment Details:</h5>
                    <p><strong>Bank Name:</strong> State Bank of India</p>
                    <p><strong>Account Name:</strong> Sunshine High School</p>
                    <p><strong>Account No:</strong> 500123456789</p>
                    <p><strong>IFSC Code:</strong> SBIN0001234</p>
                    <p class="mt-3"><strong>Payment Method:</strong> Bank Transfer, Online Payment</p>
                </div>
            </div>
        </div>

        <div class="invoice-items">
            <h5>Fee Breakdown:</h5>
            <div class="table-responsive">
                <table class="table table-bordered invoice-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Description</th>
                            <th class="text-end">Amount</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>1</td>
                            <td>Tuition Fee - Fall Semester 2024</td>
                            <td class="text-end">₹1,500.00</td>
                        </tr>
                        <tr>
                            <td>2</td>
                            <td>Library Fee</td>
                            <td class="text-end">₹50.00</td>
                        </tr>
                        <tr>
                            <td>3</td>
                            <td>Sports Activity Fee</td>
                            <td class="text-end">₹75.00</td>
                        </tr>
                        <tr>
                            <td>4</td>
                            <td>Lab Fee</td>
                            <td class="text-end">₹100.00</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="row invoice-summary justify-content-end">
            <div class="col-md-6">
                <table class="table table-borderless">
                    <tbody>
                        <tr>
                            <td class="text-end"><strong>Subtotal:</strong></td>
                            <td class="text-end">₹1,725.00</td>
                        </tr>
                        <tr>
                            <td class="text-end"><strong>Discount:</strong></td>
                            <td class="text-end">₹0.00</td>
                        </tr>
                        <tr>
                            <td class="text-end"><strong>Tax (GST @ 0%):</strong></td>
                            <td class="text-end">₹0.00</td>
                        </tr>
                        <tr class="total-row">
                            <td class="text-end"><strong>Grand Total:</strong></td>
                            <td class="text-end grand-total-value">₹1,725.00</td>
                        </tr>
                        <tr class="total-row">
                            <td class="text-end text-success"><strong>Amount Paid:</strong></td>
                            <td class="text-end text-success">₹0.00</td>
                        </tr>
                         <tr class="total-row">
                            <td class="text-end text-danger"><strong>Amount Due:</strong></td>
                            <td class="text-end amount-due-value">₹1,725.00</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="invoice-footer">
            <p>Thank you for your timely payment!</p>
            <p>Please make payment by the due date to avoid late fees.</p>
            <p>&copy; 2024 Sunshine High School. All rights reserved.</p>
        </div>

        <div class="invoice-actions">
            <button class="btn btn-print-custom me-2" onclick="window.print()">
                <i class="bi bi-printer-fill me-2"></i>Print Invoice
            </button>
            <button class="btn btn-download-pdf me-2" id="downloadPdfBtn">
                <i class="bi bi-file-earmark-arrow-down-fill me-2"></i>Download PDF
            </button>
            <a href="fees.html" class="btn btn-outline-secondary">
                <i class="bi bi-arrow-left me-2"></i>Back to Fees Management
            </a>
        </div>
    </div>

    <!-- Bootstrap JS and Popper.js -->
    <script src="assets/js/popper.min.js"></script>
    <script src="assets/js/bootstrap.min.js"></script>

    <!-- jsPDF and html2canvas Libraries for PDF download -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const downloadPdfBtn = document.getElementById('downloadPdfBtn');
            const invoiceContainer = document.getElementById('invoiceContainer');
            const invoiceActions = document.querySelector('.invoice-actions');

            function generateAndDownloadPdf() {
                invoiceActions.style.display = 'none'; // Temporarily hide the action buttons

                // Ensure all images are loaded before taking screenshot
                Promise.all(Array.from(document.images).filter(img => !img.complete).map(img => new Promise(resolve => { img.onload = img.onerror = resolve; }))).then(() => {
                    html2canvas(invoiceContainer, {
                        scale: 2, // Increase scale for better resolution in PDF
                        // logging: true, // Uncomment for detailed console logging from html2canvas
                    }).then(canvas => {
                        const imgData = canvas.toDataURL('image/png');
                        
                        // Access the jsPDF constructor from the global 'jspdf' object
                        const pdf = new window.jspdf.jsPDF({
                            orientation: 'p', // Portrait
                            unit: 'mm',
                            format: 'a4'
                        });

                        const imgWidth = pdf.internal.pageSize.getWidth();
                        // No need to calculate imgHeight vs pageHeight for pagination anymore.
                        // The image will be added, scaled to fit the width.
                        // If its calculated height exceeds the page height, it will be clipped.
                        const imgHeight = (canvas.height * imgWidth) / canvas.width;

                        pdf.addImage(imgData, 'PNG', 0, 0, imgWidth, imgHeight);

                        // REMOVED: The while loop that added additional pages.
                        // Now, only the first page is generated.

                        pdf.save('invoice.pdf');
                        invoiceActions.style.display = 'block'; // Show action buttons again
                    }).catch(error => {
                        console.error('Error in html2canvas:', error);
                        alert('Could not generate PDF from HTML. Please try again. Check your browser console (F12) for error details.');
                        invoiceActions.style.display = 'block';
                    });
                }).catch(error => {
                    console.error('Error loading images:', error);
                    alert('Could not generate PDF due to image loading issues. Please ensure all images are accessible locally or via CORS-enabled servers.');
                    invoiceActions.style.display = 'block';
                });
            }

            downloadPdfBtn.addEventListener('click', generateAndDownloadPdf);
        });
    </script>
</body>
</html>